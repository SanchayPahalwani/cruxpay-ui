"use strict";$(document).ready(function(){var a,d=new function(){var l=this;this.availableStates=["registration","customisation"],this.registration={el:$("#registration"),hide:function(){this.el.addClass("cs-hide")},show:function(){this.el.removeClass("cs-hide")}},this.customisation={el:$("#customisation"),hide:function(){this.el.addClass("cs-hide")},show:function(){this.el.removeClass("cs-hide")}},this.renderState=function(e){if(l.availableStates.includes(e)){var t=!0,i=!1,a=void 0;try{for(var r,s=l.availableStates[Symbol.iterator]();!(t=(r=s.next()).done);t=!0){var n=r.value;n===e?l[n].show():l[n].hide()}}catch(e){i=!0,a=e}finally{try{t||null==s.return||s.return()}finally{if(i)throw a}}}},this.renderApp=function(e){e&&e.payIDName?(l.renderState("customisation"),p.init({payIDName:e.payIDName,availableCurrencies:e.availableCurrencies,publicAddressCurrencies:e.publicAddressCurrencies,allCurrencies:e.assetList&&0<e.assetList.length?function(e){return e.map(function(e){return{name:e.name,symbol:e.symbol,img:e.image_sm_url}})}(e.assetList):[]})):l.renderState("registration")}},u={show:function(e,t){e.attr("disabled","true"),e.off("click",t)},hide:function(e,t){e.removeAttr("disabled","false"),e.on("click",t)}},e=document.querySelectorAll(".mdc-text-field"),t=!0,i=!1,r=void 0;try{for(var s,n=e[Symbol.iterator]();!(t=(s=n.next()).done);t=!0){var l=s.value;mdc.textField.MDCTextField.attachTo(l)}}catch(e){i=!0,r=e}finally{try{t||null==n.return||n.return()}finally{if(i)throw r}}var o={input:$("#cruxpayId"),inputParent:$(".cruxpay-id__container"),helperText:$("#cruxpay-id__helper-text"),parentContainer:$(".cruxpay-id__container").parent(),isValid:!1,displayError:function(e){this.helperText.removeClass("helper-text--success"),this.inputParent.addClass("mdc-text-field--invalid"),this.parentContainer.addClass("has-error"),this.helperText.html(e)},displaySuccess:function(e){o.inputParent.removeClass("mdc-text-field--invalid"),o.helperText.addClass("helper-text--success"),o.parentContainer.removeClass("has-error"),o.helperText.html(e)},displayHelpText:function(e){o.helperText.removeClass("helper-text--success"),o.inputParent.removeClass("mdc-text-field--invalid"),o.parentContainer.removeClass("has-error"),o.helperText.html(e)},getId:function(){return this.input.val()},validation:{hasDigit:function(e){return/[0-9]/.test(e)},hasAlphabets:function(e){return/[A-Za-z]/.test(e)},isValid:function(e){var t=!1;return this.hasDigit(e)&&this.hasAlphabets(e)&&(t=!0),t}},runValidations:function(e){this.validation.hasDigit(e)?this.isValid=!0:(this.isValid=!1,this.displayError("Your ID should contain numbers")),this.validation.hasAlphabets(e)?this.isValid=!0:(this.isValid=!1,this.displayError("Your ID should contain alphabets"))}},c=null;o.input.on("keyup",function(t){o.displayHelpText("Checking availability"),o.isValid=!1,clearTimeout(c),c=setTimeout(function(){var e=t.target.value;e&&0<e.length&&(o.validation.hasDigit(e)?o.validation.hasAlphabets(e)?function(a){$.ajax({type:"GET",url:"https://registrar.coinswitch.co:3000/status/".concat(a),success:function(e){o.isValid=!1,o.displayError("".concat(a," is unavailable"))},error:function(e,t,i){404==e.status&&(o.isValid=!0,o.displaySuccess("".concat(a," is available")))}})}(e):o.displayError("Your ID should contain alphabets"):o.displayError("Your ID should contain numbers"))},500)});var h={input:$("#cruxpayPassword"),helperText:$("#cruxpay-password__helper-text"),inputParent:$(".cruxpay-password__container"),parentContainer:$(".cruxpay-password__container").parent(),isValid:!1,validation:{isValid:function(e){return/^[a-zA-Z0-9$@!#^&%_-]{8,50}$/.test(String(e).toLowerCase())},containsId:function(e){return e===o.input.val()},hasDigit:function(e){return/[0-9]/.test(e)},hasLowerCase:function(e){return/[a-z]/.test(e)},hasUpperCase:function(e){return/[A-Z]/.test(e)},hasSpecialCharacter:function(e){return/(?=.*[!#$%&?@"])/.test(e)}},displayError:function(e){this.helperText.removeClass("helper-text--success"),this.inputParent.addClass("mdc-text-field--invalid"),this.parentContainer.addClass("has-error"),this.helperText.html(e)},clearAllError:function(){this.helperText.addClass("helper-text--success"),this.inputParent.removeClass("mdc-text-field--invalid"),this.parentContainer.removeClass("has-error"),this.helperText.html("")},toggleValidationBlock:function(e){e?$(".validation-rules").css("opacity",1):$(".validation-rules").css("opacity",0)},setValidation:function(e,t){var i=$("#validation-".concat(e));this.isValid=t,i&&0<i.length&&(t?(i.removeClass("rule-isInvalid"),i.addClass("rule-isValid")):(i.addClass("rule-isInvalid"),i.removeClass("rule-isValid")))},getPassword:function(){return this.input.val()},runValidations:function(e){this.validation.isValid(e)?this.setValidation("charLen",!0):(this.setValidation("charLen",!1),this.displayError("Minimum length required is 8. Only following special characters !,#,$,%,&,?,@ are allowed")),this.validation.containsId(e)?(this.setValidation("sameAsId",!1),this.displayError("Password must be different from CruxPay ID")):this.setValidation("sameAsId",!0),this.validation.hasDigit(e)?this.setValidation("digit",!0):(this.setValidation("digit",!1),this.displayError("Password must be have atleast one number")),this.validation.hasLowerCase(e)?this.setValidation("lowercase",!0):(this.setValidation("lowercase",!1),this.displayError("Password must be have atleast one lowercase letter")),this.validation.hasUpperCase(e)?this.setValidation("uppercase",!0):(this.setValidation("uppercase",!1),this.displayError("Password must be have atleast one uppercase letter")),this.validation.hasSpecialCharacter(e)?(this.setValidation("specialCharater",!0),this.clearAllError()):(this.setValidation("specialCharater",!1),this.displayError("Password must be have atleast one of following special characters !,#,$,%,&,?,@ are allowed"))}};h.input.on("keyup",function(e){h.toggleValidationBlock(!0),h.runValidations(h.getPassword())}),$("#createId").on("click",function e(){if(o.isValid&&h.isValid){u.show($("#createId"),e);var t=o.getId(),i=h.getPassword();d.data={newPayIDName:t,newPayIDPass:i},a.payIDName=t,d.renderApp(a)}else h.isValid||h.runValidations(h.getPassword()),o.isValid||(o.getId()&&0<o.getId().length?o.validation.isValid(o.getId())?o.displayError("".concat(o.getId()," is unavailable")):o.runValidations(o.getId()):o.displayError("cruxpay id is needed"))});var p={container:$("#currencyContainer"),selectedCurCintainer:$("#selectedCurContainer"),search:$("#cruxSearchCur"),selectedRadio:"custom",radioContainer:$(".customisation__radio-select"),init:function(e){var i=this,t=e.payIDName,a=e.availableCurrencies,r=e.publicAddressCurrencies,s=e.allCurrencies;$("#cruxpayIdName").html(t);var n=[],l=!0,o=!1,c=void 0;try{for(var d,u=s[Symbol.iterator]();!(l=(d=u.next()).done);l=!0){var h=d.value;a.includes(h.symbol.toUpperCase())&&(r.includes(h.symbol.toUpperCase())?h.selected=!0:h.selected=!1,n.push(h))}}catch(e){o=!0,c=e}finally{try{l||null==u.return||u.return()}finally{if(o)throw c}}this.list=n,this.renderRadios(),this.search.on("keyup",function(e){var t=i.filter(i.list,e.target.value);i.renderCurList(t)}),this.renderCurList(this.list),this.renderSelectedCurPills(this.list)},availableRadios:[{id:"radio-selectCustom",value:"custom",name:"Custom"},{id:"radio-selectAll",value:"all",name:"All"},{id:"radio-selectPopular",value:"popular",name:"Popular"},{id:"radio-selectNone",value:"none",name:"None"}],renderCurList:function(e){var t="",i=!0,a=!1,r=void 0;try{for(var s,n=e[Symbol.iterator]();!(i=(s=n.next()).done);i=!0){var l=s.value;t+=this.renderCur(l)}}catch(e){a=!0,r=e}finally{try{i||null==n.return||n.return()}finally{if(a)throw r}}$(this.container).html(t),this.bindCheckboxEvents()},renderCur:function(e){var t=e.name,i=e.symbol,a=e.img,r=e.selected;return'\n            <div class="customisation__currency '.concat(r?"customisation__currency--isSelected":"",' ">\n                <div class="mdc-form-field">\n                    <div class="mdc-checkbox">\n                        <input\n                            data-symbol="').concat(i,'"\n                            type="checkbox"\n                            class="mdc-checkbox__native-control"\n                            id="checkbox-').concat(i,'"\n                            ').concat(r?"checked":"",'\n                        />\n                        <div class="mdc-checkbox__background">\n                            <svg class="mdc-checkbox__checkmark" viewBox="0 0 24 24">\n                            <path\n                                class="mdc-checkbox__checkmark-path"\n                                fill="none"\n                                d="M1.73,12.91 8.1,19.28 22.79,4.59"\n                            />\n                            </svg>\n                            <div class="mdc-checkbox__mixedmark"></div>\n                        </div>\n                    </div>\n                    <label for="checkbox-').concat(i,'" class="customisation__checkbox-label">\n                        <img class="customisation__currency-logo" src="').concat(a,'" />\n                        <div class="customisation__currency-name">').concat(t,'</div>\n                    </label>\n                </div>\n                <div class="customisation__currency-symbol">').concat(i.toUpperCase(),"</div>\n            </div>\n            ")},renderSelectedCurPills:function(e){var t="",i=!0,a=!1,r=void 0;try{for(var s,n=e[Symbol.iterator]();!(i=(s=n.next()).done);i=!0){var l=s.value;l.selected&&(t+=this.renderSelectedPill(l))}}catch(e){a=!0,r=e}finally{try{i||null==n.return||n.return()}finally{if(a)throw r}}$(this.selectedCurCintainer).html(t),this.bindPillEvents()},renderSelectedPill:function(e){var t=e.symbol;return'\n                <div class="selected-currency__pill">\n                    <strong>'.concat(t.toUpperCase(),'</strong>\n                    <i class="material-icons" data-symbol="').concat(t,'">clear</i>\n                </div>\n            ')},renderRadios:function(){var e="",t=!0,i=!1,a=void 0;try{for(var r,s=this.availableRadios[Symbol.iterator]();!(t=(r=s.next()).done);t=!0){var n=r.value;e+=this.renderRadioEl(n)}}catch(e){i=!0,a=e}finally{try{t||null==s.return||s.return()}finally{if(i)throw a}}$(this.radioContainer).html(e),this.bindRadioEvents()},renderRadioEl:function(e){var t=e.id,i=e.value,a=e.name;return'\n                <div class="mdc-form-field">\n                    <div class="mdc-radio mdc-custom-radio">\n                        <input class="mdc-radio__native-control" type="radio" id="'.concat(t,'" name="radios" value="').concat(i,'">\n                        <div class="mdc-radio__background">\n                            <div class="mdc-radio__outer-circle"></div>\n                            <div class="mdc-radio__inner-circle"></div>\n                        </div>\n                    </div>\n                    <label for="').concat(t,'">').concat(a,"</label>\n                </div>\n            ")},filter:function(e,t){var i=t||"";try{var a=new RegExp(i,"ig");return e.filter(function(e){return e.name.match(a)||e.symbol.match(a)})}catch(e){return[]}},bindCheckboxEvents:function(){var a=this;$(".mdc-checkbox__native-control").on("click",function(e){var t=$(e.target);for(var i in a.list){a.list[i].symbol===t.data("symbol")&&(a.list[i].selected=t.is(":checked"))}$("#radio-selectCustom").prop("checked","true"),a.renderSelectedCurPills(a.list)})},bindPillEvents:function(){var a=this;$(".selected-currency__pill").on("click",function(e){var t=$(e.target);for(var i in a.list){a.list[i].symbol===t.data("symbol")&&(a.list[i].selected=!1)}$("#radio-selectCustom").prop("checked","true"),a.renderCurList(a.list),a.renderSelectedCurPills(a.list)})},bindRadioEvents:function(){var n=this;$(".mdc-radio__native-control").on("click",function(e){switch(e.target.value){case"custom":n.selectedRadio="custom";break;case"popular":var t=["btc","eth","xrp","bch","ltc"];for(var i in n.list){var a=n.list[i];t.includes(a.symbol)?n.list[i].selected=!0:n.list[i].selected=!1}n.renderCurList(n.list),n.renderSelectedCurPills(n.list),n.selectedRadio="popular";break;case"all":for(var r in n.list)n.list[r].selected=!0;n.renderCurList(n.list),n.renderSelectedCurPills(n.list),n.selectedRadio="all";break;case"none":for(var s in n.list)n.list[s].selected=!1;n.renderCurList(n.list),n.renderSelectedCurPills(n.list),n.selectedRadio="none"}});var e=$(".mdc-radio__native-control"),t=!0,i=!1,a=void 0;try{for(var r,s=e[Symbol.iterator]();!(t=(r=s.next()).done);t=!0){var l=r.value;this.selectedRadio===l.value&&l.setAttribute("checked","true")}}catch(e){i=!0,a=e}finally{try{t||null==s.return||s.return()}finally{if(i)throw a}}}};$("#updateCustomization").on("click",function e(){u.show($("#updateCustomization"),e);var t=[],i=!0,a=!1,r=void 0;try{for(var s,n=p.list[Symbol.iterator]();!(i=(s=n.next()).done);i=!0){var l=s.value;l.selected&&t.push(l.symbol.toUpperCase())}}catch(e){a=!0,r=e}finally{try{i||null==n.return||n.return()}finally{if(a)throw r}}if(d.isExistingAccount){var o={type:"editExisting",data:{checkedCurrencies:t}};o=JSON.stringify(o),o=OpenPay.Encryption.eciesEncryptString(o,window.encryptionKey),window.parent.postMessage(o,"*")}else{var c={type:"createNew",data:{newPayIDName:d.data.newPayIDName,newPayIDPass:d.data.newPayIDPass,checkedCurrencies:t}};c=OpenPay.Encryption.eciesEncryptString(JSON.stringify(c),window.encryptionKey),window.parent.postMessage(c,"*")}}),$("#closeSetup").on("click",function(){var e={type:"closeIframe"};e=JSON.stringify(e),e=OpenPay.Encryption.eciesEncryptString(JSON.stringify(e),window.encryptionKey),window.parent.postMessage(e,"*")}),function e(){window.walletInfo?(a=window.walletInfo,d.isExistingAccount=!!a.payIDName,d.renderApp(a)):setTimeout(function(){e()},500)}()});